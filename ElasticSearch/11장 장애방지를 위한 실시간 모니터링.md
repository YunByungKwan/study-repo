# 11장.  장애  방지를 위한 실시간 모니터링

>  클러스터를 안정적으로 운영하려면 상시 모니터링을 수행해야함.
>
> Health 체크는 기본,  내부 모듈의 자세한 상태를 실시간으로 볼 수 있어야함. 
>
> 이를 위해 다양한 형태의 모니터링 API를 제공해줌.

---

## 1. 클러스터 Health 체크

> _cluster/health API

- 클러스터 현재 상태 실시간 확인 가능
- 간단하면서 빠른 장애대응 가능하게함. 필수적으로 사용



### 클러스터 레벨 Health 체크

`GET /_cluster/health`

- 결과로 클러스터 레벨 간단한 요약정보 제공



### 인덱스 레벨 Health 체크

`GET /_cluster/health?level=indices`

- 기존 결과에 인덱스 정보가 포함되어 결과로 리턴한다.
- 모든 인덱스 정보 포함 리턴
  - 좀 더 자세한 요약정보 살펴볼 수 있음.
  - 문제 발생 인덱스 찾는데 도움



### 샤드 레벨 Health 체크

`GET /_cluster/health?level=shards`

- 인덱스 내부의 샤드레벨 까지 포함된 정보 제공
- 3개 중 제일 자세함.



### Health 체크 활용하기

- `GET /_cluster/health/movie`  
  - movie 인덱스 대상 health 체크
- `GET /_cluster/health/movie?level=indices`
  - movie  인덱스 대상 인덱스레벨 health 체크
- `GET /_cluster/health/movie?level=shards`
  - movie 인덱스 대상 샤드레벨 health 체크 

---

## 2. 물리적인 클러스터 상태 정보 조회

> _cluster/state API를 이용하면 클러스터의 환경설정이나 노드의 라우팅 방식, 인덱스의 매핑  구성 등 세부적인 상태 정보를 확인가능



### 클러스터 레벨 물리 상태 조회

`GET _cluster/state`

- 클러스터 구성의 기본이 되는
  - metadata 정보
  - Routing_table 정보
  - Restore/Snapshot 정보



### 노드 레벨 물리 상태 조회

`GET _nodes`

- 전체 노드 대상이라 많은 정보가 제공되므로 필터링 조건도 제공됨.
  - 특정 IP 노드
  - 특정 노드  ID
  - 호출 받은 노드 상태 조회

---

## 3. 클러스터에 대한 실시간 모니터링

> 클러스터 운영시 반드시 필요한것이 모니터링이다.
> 
>
> 엘라스틱서치 클러스터
>
> └  다수의 노드
>
> ​     └  다수의 샤드
>
> 
>
> 다양한 관점에서 모니터링 하는 것이 좋다.



### 클러스터 레벨 실시간 모니터링

`GET _cluster/stats`

- 클러스터 전체에서 통계를 검색할 수 있다.
- 물리적인 노드의 정보를 얻을 수 있다.
- 노드의 역할, 운영체제 정보, 메모리 사용량, CPU 사용량 등 다양한 지표 제공



### 노드 레벨 실시간 모니터링 

`GET _nodes/stats`

- 클러스터  수준 -> 개별 노드 수준 대한 통계 정보를 상세하게 제공



### 인덱스 레벨의 실시간 모니터링

`GET _stats`

- 클러스터를 인덱스  수준에서 들여다볼 수 있게 해줌.
- 인덱스는 여러 노드에 걸쳐 존재하는 논리적인 개념이므로
  - 노드레벨과 인덱스레벨을 같이 살펴보면 클러스터의 물리적, 논리적인 측면을 복합적으로 확인 가능










