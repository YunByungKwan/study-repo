# 8장 엘라스틱서치 클라이언트

- 실무에서는 엘라스틱서치에 접근할 때 전용 클라이언트 모듈을 많이 사용
- 엘라스틱서치가 제공하는 전용 클라이언트를 사용해 색인이나 검색 작업을 수행하는 방법 소개
- 자바 클라이언트



## 8.1 엘라스틱서치 클라이언트 이해하기

### 자바 클라이언트 모듈

| 자바 클라이언트      | 설명                                                         |
| -------------------- | ------------------------------------------------------------ |
| REST 클라이언트      | - Java High Level REST Client<br />- HTTP 방식을 이용해 엘라스틱서치와 통신<br />- 내부적으로는 HttpClient 모듈 사용 |
| Transport 클라이언트 | - 초기부터 제공되던 클라이언트 방식 (상대적으로 빠름)<br />- 소켓을 이용해 엘라스틱서치와 통신<br />- 내부적으로 Netty 모듈 사용 |
- Transport 클라이언트 Deprecated
-  REST 클라이언트가 Transport 클라이언트의 모든 기능을 다 제공하지 못함.



## 8.2 Transport 클라이언트

### 매핑 API

- 인덱스를 생성할 때 Indice API를 사용한다.
  - 인덱스의 샤드 개수를 설정하거나 나만의 분석기를 정의할 수 있다.
  - 각 필드에 대한 데이터 타입을 정의하거나 세세한 옵션을 설정하는 것도 가능
- 매핑 생성을 위해
  - 스키마를 JSON 형태로 생성
  - 생성된 JSON 데이터를 Transport 클라이언트를 이용해 엘라스틱서치에 전달하면 인덱스가 생성



### 문서 API

- Document API를 이용하면 문서 CRUD 가능
- 인덱스에 데이터를 넣는 방법
  - 한 건씩 추가하는 방법
  - 대량의 문서를 한번에 추가하는 방법

**BULK PROCESSOR**

- 한번에 처리할 문서 수, 문서 처리 방법, 데이터 새로고침 주기 등을 설정할 수 있는 인터페이스
- 데이터 양에 상관없이 지정한 조건을 만족하면 엘라스틱서치로 색인 요청을 보내는 방식으로 동작
- _bulk API와 동일한 효과



### 검색 API

- 사용자가 입력한 검색어를 질의해서 결과를 반환받을 수 있다.
- 하나의 인덱스 뿐 아니라 여러 개의 인덱스를 한번에 조회 가능



### 집계 API

- 엘라스틱서치에 저장되어있는 데이터의 통계 작업
- 검색 API > `Search API`에 메서드만 추가하여 사용한다.



### Query DSL API

- Query DSL API는 URI 방식의 쿼리가 아닌 `Request Body에 JSON 형태로 질의문을 실어 보내는 방식` Search API와 함께 사용한다.
  - setQuery 메서드 내 parameter 타입 -> QueryBuilder
- Match All Query, Full Text Queries, Term level Queries, ....



## 8.3 High Level REST 클라이언트

- 최신버전 엘라스틱서치는 Transport 클라이언트가 Deprecated
- 앞으로는 REST 클라이언트를 사용해야만. 한다

```
Transport 클라이언트는 JSON을 파싱하고 이를 자바 객체로 변환한 다음, Transport Network 계층을 통해 바이너리 형식으로 서버로 전달된다.
성능측면에서 Transport와 REST 클라이언트 간의 차이가 무시할 수 있을 만큼 비슷해졌고,
REST 클라이언트를 사용하면 보안측면에서 HTTPS를 사용하는 게 가능하므로 엘라스틱서치 진영에서 클라이언트를 변경하기로 결정
```

- Sync, Async 방식 설정 가능



---

^오^