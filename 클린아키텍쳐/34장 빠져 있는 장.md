# 34장 빠져 있는 장

> 온라인 서점을 구축하고 있으며 고객이 주문 상태를 조회할 수 있어야한다는 유스케이스를 통해 클린 아키텍처는 잠시 제쳐놓고 설계나 코드 조직화와 관련된 몇가지 접근법을 살펴보자.


### 계층 기반 패키지

가장 단순한 설계 방식은 전통적인 수평 계층형 아키텍처이다.
기술적인 관점에서 해당 코드가 하는일에 기반해 그 코드를 계층으로 분할하는 것을 의미한다. 

![image](https://user-images.githubusercontent.com/21329617/117542236-c7279900-b052-11eb-8efd-fed225da23ee.png)

이러한 계층형 아키텍처는 업무 도메인에 대해 아무것도 말해주지 않는다.
<br>

### 기능 기반 패키지

서로 연관된 기능, 도메인 개념, 또는 Aggregate Root에 기반하여 수직의 얇은 조각으로 코드를 나누는 방식이다.

![image](https://user-images.githubusercontent.com/21329617/117542362-40bf8700-b053-11eb-8afe-aa75e2ef2619.png)

모두가 하나의 패키지에 속하게 된다. 따라서 업무 도메인에 대해 무엇인가를 알려주게 된다. (주문 관련된걸 하는구나..) 또한 주문 조회하기 유스케이스가 변경될 경우 해당 패키지에서만 찾으면되기 때문에 수월해짐. 둘중 뭐가 낫다는 없음.
<br>

### 포트와 어댑터

육각형 아키텍처 혹은 "포트와 어댑터" 방식으로 접근하는 이유는 업무 도메인에 초점을 둔 코드가 프레임워크나 DB 같은 세부사항에서 독립적이며 분리된 아키텍처를 만들기 위함이다.

![image](https://user-images.githubusercontent.com/21329617/117542497-d9560700-b053-11eb-9184-7ff12adbc852.png)

외부(인프라)가 내부(도메인)에 의존하며 절대 그 반대가 되선 안됌.

![image](https://user-images.githubusercontent.com/21329617/117542523-f25eb800-b053-11eb-8d93-b1dffa179625.png)

domain 패키지가 내부이고, 나머지 패키지는 외부이다.
의존성이 내부로 흐르고 있음에 주목해라.
<br>

### 컴포넌트 기반 패키지

![image](https://user-images.githubusercontent.com/21329617/117542773-e4f5fd80-b054-11eb-939a-353464271a03.png)

컴포넌트 기반 패키지에서는 사용자 인터페이스를 큰 단위의 컴포넌트로 분리한다.
업무 로직과 영속성 관련 코드를 컴포넌트로써 하나로 묶는다.
컴포넌트 기반 패키지 접근법의 주된 이점은 Orders와 관련된 무언가를 코딩할 때 오직 OrderComponent만 둘러보면 된다는 점이다
<br>

### 구현 세부사항엔 항상 문제가 있다.

앞서 네가지 접근법이 코드를 조직화하는 서로 다른 아키텍처 스타일로 여겨질 수 있지만 세부사항을 잘못 구현하면 이런 견해도 빠르게 흐트러질 수 있다.
- 모든 타입에서 Public 지시자를 사용한다는 것은 인스턴스를 직접 생성할 수 있기 때문에 아키텍처 스타일을 위반하게 될 수 있다.
<br>

### 조직화 vs 캡슐화

자바 어플리케이션에서 public 지시자를 과용하면 앞에서 제시한 아키텍처 접근법들은 본질적으로 같아진다.

자바 접근 지시자를 적절하게 사용하면 타입을 패키지로 배치하는 방식에 따라 각 타입에 접근할 수 있는 정보가 크게 달라진다. 
<br>

### 결론

이 장은 최적의 설계를 꾀했더라도, 구현 전략에 얽힌 복잡함을 고려하지 않으면 설계가 순식간에 망가질 수도 있다는 사실을 강조하는데 그 목적이 있다.